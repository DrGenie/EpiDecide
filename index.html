<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EpiDecide - FETP Decision Aid Tool</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-papNMzNnQn5h+1G+FHu8SyuXHs6A1k+Ln7tK5qRo1l5eYm6Jzv+1pArJ7N4C9FfpRrmAgM3tYWd3FZ9jKz1Bw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="container">
  <header>
    <h1>FETP Decision Aid Tool</h1>
    <p>
      This tool helps policy makers plan and scale Field Epidemiology Training Programs (FETP) by predicting programme uptake,
      evaluating cost–benefit tradeoffs, and comparing key programme features.
    </p>
  </header>

  <nav class="tabs" role="tablist">
    <button class="tablink active" data-tab="introTab" aria-selected="true">
      <i class="fa-solid fa-info-circle"></i><span> Introduction</span>
    </button>
    <button class="tablink" data-tab="instructionsTab" aria-selected="false">
      <i class="fa-solid fa-circle-question"></i><span> Instructions</span>
    </button>
    <button class="tablink" data-tab="attributesTab" aria-selected="false">
      <i class="fa-solid fa-list"></i><span> Attributes</span>
    </button>
    <button class="tablink" data-tab="inputsTab" aria-selected="false">
      <i class="fa-solid fa-sliders"></i><span> Inputs</span>
    </button>
    <button class="tablink" data-tab="wtpTab" aria-selected="false">
      <i class="fa-solid fa-chart-bar"></i><span> WTP Results</span>
    </button>
    <button class="tablink" data-tab="probTab" aria-selected="false">
      <i class="fa-solid fa-chart-pie"></i><span> Predicted Uptake</span>
    </button>
    <button class="tablink" data-tab="costsTab" aria-selected="false">
      <i class="fa-solid fa-calculator"></i><span> Costs &amp; Benefits</span>
    </button>
    <button class="tablink" data-tab="scenariosTab" aria-selected="false">
      <i class="fa-solid fa-folder-open"></i><span> Saved Scenarios</span>
    </button>
  </nav>

  <!-- Introduction Tab -->
  <section id="introTab" class="tabcontent" tabindex="0" style="display: block;">
    <div class="intro-box">
      <p>
        FETPs are critical for rapid public health responses. This decision aid uses discrete choice experiment (DCE)
        estimates to forecast programme uptake, assess economic tradeoffs, and compare key programme features.
      </p>
      <ul>
        <li><strong>Instructions</strong> – A simple guide to use the tool.</li>
        <li><strong>Attributes</strong> – Understand the main features that define the training programme.</li>
        <li><strong>Inputs</strong> – Configure your programme options.</li>
        <li><strong>WTP Results</strong> – See estimated willingness-to-pay values.</li>
        <li><strong>Predicted Uptake</strong> – View the forecasted participation rate.</li>
        <li><strong>Costs &amp; Benefits</strong> – Review a detailed economic summary.</li>
        <li><strong>Saved Scenarios</strong> – Save and compare different configurations.</li>
      </ul>
    </div>
  </section>

  <!-- Instructions Tab -->
  <section id="instructionsTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>How to Use This Tool</h4>
      <ol>
        <li style="margin-left: 20px;">Review the <strong>Attributes</strong> tab for an overview of programme features.</li>
        <li style="margin-left: 20px;">In the <strong>Inputs</strong> tab, select your desired Level of Training, Training Model, Stipend Amount, and Annual Training Capacity. Adjust the Fee per Training Completion using the slider. Then click “Calculate &amp; View Results.”</li>
        <li style="margin-left: 20px;">All selections are required. Missing fields will trigger an alert.</li>
        <li style="margin-left: 20px;">The <strong>WTP Results</strong> tab shows a bar chart with error estimates.</li>
        <li style="margin-left: 20px;">The <strong>Predicted Uptake</strong> tab displays a doughnut chart of the forecasted participation.</li>
        <li style="margin-left: 20px;">The <strong>Costs &amp; Benefits</strong> tab provides a breakdown of costs and estimated benefits, along with explanations.</li>
        <li style="margin-left: 20px;">Saved scenarios can be compared and exported to PDF.</li>
      </ol>
    </div>
  </section>

  <!-- Attributes Tab -->
  <section id="attributesTab" class="tabcontent" tabindex="0">
    <h2>Key Attributes</h2>
    <div class="attributes-list">
      <!-- Attribute Card 1: Level of Training -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#3498db" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#3498db" stroke-width="2" fill="none"/>
            <path d="M12 6v6l4 2" stroke="#3498db" stroke-width="2" fill="none"/>
          </svg>
          <div class="tooltip" role="tooltip">
            Choose the training duration: Frontline (3 months), Intermediate (12 months; reference), or Advanced (24 months).
          </div>
        </div>
        <div class="attribute-content">
          <h4>Level of Training</h4>
          <p>3-month, 12-month, or 24-month programmes.</p>
        </div>
      </div>
      <!-- Attribute Card 2: Training Model -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#e67e22" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#e67e22" stroke-width="2" fill="none"/>
            <path d="M12 4a8 8 0 0 1 0 16 8 8 0 0 1 0-16z" fill="#e67e22"/>
          </svg>
          <div class="tooltip" role="tooltip">
            Participants can continue working while training (In-service; reference) or study full time with financial support (Scholarship-based).
          </div>
        </div>
        <div class="attribute-content">
          <h4>Training Model</h4>
          <p>In-service or Scholarship-based training.</p>
        </div>
      </div>
      <!-- Attribute Card 3: Stipend Amount -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#27ae60" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#27ae60" stroke-width="2" fill="none"/>
            <path d="M12 6v6l4 2" stroke="#27ae60" stroke-width="2" fill="none"/>
          </svg>
          <div class="tooltip" role="tooltip">
            Financial support can reduce barriers. Options: $500 (reference), $1000, $1500, $2000.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Stipend Amount</h4>
          <p>Incentives provided to participants.</p>
        </div>
      </div>
      <!-- Attribute Card 4: Annual Training Capacity -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#8e44ad" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#8e44ad" stroke-width="2" fill="none"/>
            <path d="M8 12h8M12 8v8" stroke="#8e44ad" stroke-width="2" fill="none"/>
          </svg>
          <div class="tooltip" role="tooltip">
            Choose the number of trainees per cycle. Options: 100 (+0.30), 500 (reference), 1000 (–0.30).
          </div>
        </div>
        <div class="attribute-content">
          <h4>Annual Training Capacity</h4>
          <p>Number of participants per training cycle.</p>
        </div>
      </div>
      <!-- Attribute Card 5: Fee per Training Completion -->
      <div class="attribute-card" tabindex="0">
        <div class="attribute-icon">
          <svg width="24" height="24" fill="#c0392b" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#c0392b" stroke-width="2" fill="none"/>
            <path d="M10 15l-3-3 1.4-1.4 1.6 1.6L15 7l1.4 1.4-6.4 6.4z" fill="#c0392b"/>
          </svg>
          <div class="tooltip" role="tooltip">
            This fee is charged upon completion of the training and depends on the training level.
          </div>
        </div>
        <div class="attribute-content">
          <h4>Fee per Training Completion</h4>
          <p>The amount charged to participants after training.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Inputs Tab -->
  <section id="inputsTab" class="tabcontent" tabindex="0">
    <div class="input-card">
      <h2>Configure FETP Attributes</h2>
      <p>Select your options for the programme. Choose a Level of Training, Training Model, Stipend Amount, and Annual Training Capacity.
         Adjust the Fee per Training Completion using the slider below. All fields are required.</p>
      <form onsubmit="event.preventDefault();">
        <div class="input-cards">
          <!-- Level of Training (Ref: Intermediate) -->
          <div class="input-level-card">
            <h3>Level of Training <span class="reference">(Ref: Intermediate)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="levelTraining" id="frontlineRadio" value="frontline" />
                Frontline (3 months)
              </label>
              <label>
                <input type="radio" name="levelTraining" id="intermediateRadio" value="intermediate" checked/>
                Intermediate (12 months)
              </label>
              <label>
                <input type="radio" name="levelTraining" id="advancedRadio" value="advanced" />
                Advanced (24 months)
              </label>
            </div>
          </div>
          <!-- Training Model (Ref: In-service) -->
          <div class="input-level-card">
            <h3>Training Model <span class="reference">(Ref: In-service)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="trainingModel" id="inserviceRadio" value="inservice" checked/>
                In-service Training
              </label>
              <label>
                <input type="radio" name="trainingModel" id="scholarshipRadio" value="scholarship" />
                Scholarship-based Training
              </label>
            </div>
          </div>
          <!-- Stipend Amount (Ref: $500) -->
          <div class="input-level-card">
            <h3>Stipend Amount <span class="reference">(Ref: $500)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="stipendAmount" id="stipend500" value="500" checked/>
                $500
              </label>
              <label>
                <input type="radio" name="stipendAmount" id="stipend1000" value="1000" />
                $1000
              </label>
              <label>
                <input type="radio" name="stipendAmount" id="stipend1500" value="1500" />
                $1500
              </label>
              <label>
                <input type="radio" name="stipendAmount" id="stipend2000" value="2000" />
                $2000
              </label>
            </div>
          </div>
          <!-- Annual Training Capacity (Ref: 500 trainees) -->
          <div class="input-level-card">
            <h3>Annual Training Capacity <span class="reference">(Ref: 500 trainees)</span></h3>
            <div class="options">
              <label>
                <input type="radio" name="annualCapacity" id="capacity100" value="100" />
                100 trainees
              </label>
              <label>
                <input type="radio" name="annualCapacity" id="capacity500" value="500" checked/>
                500 trainees
              </label>
              <label>
                <input type="radio" name="annualCapacity" id="capacity1000" value="1000" />
                1000 trainees
              </label>
            </div>
          </div>
          <!-- Fee per Training Completion slider -->
          <div class="input-level-card">
            <h3>Fee per Training Completion (USD)</h3>
            <div class="options slider-option">
              <label for="costSliderFETP">
                <i class="fa-solid fa-dollar-sign"></i>
                <span id="costLabelFETP">5000</span>
              </label>
              <input type="range" id="costSliderFETP" min="1000" max="10000" step="500" value="5000"
                     oninput="updateFETPCostDisplay(this.value)" />
            </div>
          </div>
        </div>
        <div class="buttons-row">
          <button type="button" onclick="openFETPScenario()">Calculate &amp; View Results</button>
        </div>
      </form>
    </div>
    <!-- Modal for Results -->
    <div id="resultModal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <div id="modalResults"></div>
      </div>
    </div>
  </section>

  <!-- WTP Results Tab -->
  <section id="wtpTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Willingness-to-Pay (WTP) Results</h4>
      <p>
        WTP is estimated as the ratio of each attribute’s coefficient over the negative cost coefficient.
        Hover over the bars to view error estimates.
      </p>
      <div class="buttons-row">
        <button onclick="renderWTPChart()">Show WTP Charts</button>
      </div>
      <div class="chart-grid">
        <div class="chart-box" style="height:350px; overflow:hidden;">
          <h3>WTP (USD)</h3>
          <canvas id="wtpChartMain"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Predicted Uptake Tab -->
  <section id="probTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Predicted Programme Uptake</h4>
      <p>
        Click “Show Probability Plot” to view the forecasted participation rate as a doughnut chart.
      </p>
      <div class="buttons-row">
        <button onclick="renderFETPProbChart()">Show Probability Plot</button>
      </div>
      <div class="chart-grid">
        <div class="chart-box" style="height:350px; overflow:hidden;">
          <h3>Uptake Probability</h3>
          <canvas id="probChartFETP"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Costs & Benefits Tab -->
  <section id="costsTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Costs &amp; Benefits Analysis</h4>
      <p>
        This section estimates the total programme cost and the monetised benefits.
        <br>
        <small>
          Benefits are calculated by multiplying the expected QALY gain per participant by the number of trainees and then by $50,000.
          This reflects the potential economic gains from improved public health outcomes.
        </small>
      </p>
      <div class="qaly-selector">
        <label for="qalyFETPSelect">Select QALY Gain per Participant:</label>
        <select id="qalyFETPSelect" onchange="renderFETPCostsBenefits()">
          <option value="low">Low (0.01 QALYs)</option>
          <option value="moderate" selected>Moderate (0.05 QALYs)</option>
          <option value="high">High (0.08 QALYs)</option>
        </select>
      </div>
      <div id="costsFETPResults"></div>
      <div class="modelling-assumptions">
        <h3><i class="fa-solid fa-lightbulb"></i> Assumptions</h3>
        <p>
          The cost estimates are based on targeted literature and include both variable costs (fee charged per participant) and fixed costs (venue, materials, trainer fees, etc.).
        </p>
      </div>
      <div class="cost-icons">
        <button class="buttons-row" onclick="toggleCostAccordion()">Cost Breakdown</button>
        <button class="buttons-row" onclick="toggleFETPBenefitsAnalysis()">Benefits Explanation</button>
      </div>
      <!-- Detailed Cost Breakdown Accordion -->
      <div id="detailedCostBreakdown" style="display:none;">
        <div class="accordion-item">
          <h3>Direct Costs</h3>
          <div class="accordion-content">
            <h4>Training and Development</h4>
            <ul>
              <li>Venue rental for workshops: ~$3,000</li>
              <li>Training materials and content development: ~$7,000</li>
              <li>Trainer and speaker compensation: ~$8,000</li>
            </ul>
            <h4>Personnel and Technology</h4>
            <ul>
              <li>Salaries and consultant fees: ~$10,000</li>
              <li>Hardware, software, and IT support: ~$4,000</li>
            </ul>
            <h4>Logistics and Miscellaneous</h4>
            <ul>
              <li>Travel, accommodation, and catering: ~$3,500</li>
              <li>Printing, communication, and insurance: ~$2,000</li>
            </ul>
          </div>
        </div>
        <div class="accordion-item">
          <h3>Fixed Costs</h3>
          <div class="accordion-content">
            <p>
              A fixed cost of approximately ~$35,500 is assumed per training cycle to cover overheads and infrastructural investments.
            </p>
          </div>
        </div>
      </div>
      <!-- Benefits Explanation -->
      <div id="detailedFETPBenefitsAnalysis" class="cost-cards" style="display:none;">
        <div class="cost-card">
          <h4><i class="fa-solid fa-hand-holding-dollar"></i> QALY Benefits</h4>
          <p>
            Benefits are calculated as: (QALY Gain per Participant × Number of Trainees × $50,000).
            This reflects the economic value of improved health outcomes.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Scenarios Tab -->
  <section id="scenariosTab" class="tabcontent" tabindex="0">
    <div class="calculation-info">
      <h4>Saved Scenarios</h4>
      <p>
        Each scenario includes the selected options along with the computed uptake and net benefit.
        You can export saved scenarios to PDF for side-by-side comparison.
      </p>
      <div class="buttons-row">
        <button onclick="saveFETPScenario()">Save Current Scenario</button>
        <button onclick="exportFETPComparison()">Compare &amp; Export PDF</button>
      </div>
      <div class="table-container">
        <table id="FETPScenarioTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Fee (USD)</th>
              <th>Level</th>
              <th>Model</th>
              <th>Stipend</th>
              <th>Capacity</th>
              <th>Uptake (%)</th>
              <th>Net Benefit (USD)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <footer>
    <p>&copy; 2025 FETP Decision Aid. All Rights Reserved.<br/>Mesfin Genie, Newcastle Business School, The University of Newcastle, Australia</p>
  </footer>
</div>
<script src="script.js"></script>
</body>
</html>
